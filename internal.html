

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Internal behavior &mdash; PyMzn 0.10.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyMzn 0.10.1 documentation" href="index.html"/>
        <link rel="next" title="Troubleshooting" href="troubleshooting.html"/>
        <link rel="prev" title="pymzn.bin.run" href="reference/bin/pymzn.bin.run.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PyMzn
          

          
          </a>

          
            
            
              <div class="version">
                0.10.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference/index.html">Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Internal behavior</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#binary-execution">Binary execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-flattening">Model flattening</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solver-proxy-functions">Solver proxy functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solution-output-stream">Solution output stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solution-parsing">Solution parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-naming">File naming</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">PyMzn</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Internal behavior</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/internal.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="internal-behavior">
<h1>Internal behavior<a class="headerlink" href="#internal-behavior" title="Permalink to this headline">¶</a></h1>
<p>This page describes the internal behavior of PyMzn. It is useful to understand
how problems are solved, serialization is ensured, and models are parsed.</p>
<div class="section" id="binary-execution">
<h2>Binary execution<a class="headerlink" href="#binary-execution" title="Permalink to this headline">¶</a></h2>
<p>PyMzn wraps the MiniZinc tools by executing them with the <code class="docutils literal"><span class="pre">subprocess.run</span></code>
function from the standard library. The process of running a executable,
checking for errors and returning the output is carried out by the
<code class="docutils literal"><span class="pre">pymzn.bin.run</span></code> function, which takes as input either a string or a list of
arguments to pass to the <code class="docutils literal"><span class="pre">pymzn.bin.cmd</span></code> function.</p>
</div>
<div class="section" id="model-flattening">
<h2>Model flattening<a class="headerlink" href="#model-flattening" title="Permalink to this headline">¶</a></h2>
<p>The model flattening is carried out by the <code class="docutils literal"><span class="pre">pymzn.mzn2fzn</span></code> function
(in pymzn/_mzn/_minizinc.py) which in turn executes the MiniZinc <em>mzn2fzn</em>
utility to compile a MiniZinc model into a FlatZinc one.
The model flattening takes place exclusively through files. While
there is the possibility of executing the <em>mzn2fzn</em> writing the input model on
the standard input, it is rather inconvenient since it excludes the possibility
of providing inline data and data (dzn) files. Moreover, by flattening a model
from command line, there would have been naming issues, because, as explained
in the section on <cite>file naming &lt;#naming&gt;</cite>, PyMzn relies on a defined set of
naming rules to ensure isolation of the solving instances of a model.
The created files are left with the same name of the input file, as default of
the <em>mzn2fzn</em> utility. Given the <cite>file naming &lt;#naming&gt;</cite> conventions and the
internal behavior of the <code class="docutils literal"><span class="pre">pymzn.minizinc</span></code> function, the possibility of
specifying an output-base has been deemed as irrelevant and confusing, and
thus left out.</p>
</div>
<div class="section" id="solver-proxy-functions">
<h2>Solver proxy functions<a class="headerlink" href="#solver-proxy-functions" title="Permalink to this headline">¶</a></h2>
<p>To interface PyMzn to a solver, it needs a proxy function which takes the
solver&#8217;s arguments as input, executes the solver with the provided arguments
and the given FlatZinc model and returns the solution stream as output.
An example of that is the <code class="docutils literal"><span class="pre">pymzn.gecode</span></code> function, which wraps the
<em>fzn-gecode</em> command of Gecode. To the time of writing, PyMzn fully supports
Gecode and partially supports OptiMatSat, while the definition of additional
solver proxy functions is left to the user or to future development.</p>
</div>
<div class="section" id="solution-output-stream">
<h2>Solution output stream<a class="headerlink" href="#solution-output-stream" title="Permalink to this headline">¶</a></h2>
<p>The solution output stream is provided by the solver proxy function which can
then be passed to the <code class="docutils literal"><span class="pre">pymzn.solns2out</span></code> function, which wraps the MiniZinc
<em>solns2out</em> utility. The <code class="docutils literal"><span class="pre">pymzn.solns2out</span></code> function takes as input the
solution stream and the ozn file returned by the <code class="docutils literal"><span class="pre">pymzn.mzn2fzn</span></code> function
and outputs a list of solutions encoded in the format specified in the ozn
file, i.e. the format from the output statement in the model.</p>
</div>
<div class="section" id="solution-parsing">
<h2>Solution parsing<a class="headerlink" href="#solution-parsing" title="Permalink to this headline">¶</a></h2>
<p>When using the <code class="docutils literal"><span class="pre">pymzn.minizinc</span></code> function, the solutions are automatically
parsed into Python objects (unless specified otherwise). This is carried out
by dropping the output statement of the original model and inserting a new
output statement which encodes the output variables into dzn format. The
original model file is isolated from the new model file, as specified in the
<cite>File naming &lt;#naming&gt;</cite> section.</p>
<p>&lt;a name=&#8221;naming&#8221;&gt;&lt;/a&gt;</p>
</div>
<div class="section" id="file-naming">
<h2>File naming<a class="headerlink" href="#file-naming" title="Permalink to this headline">¶</a></h2>
<p>Some of the objectives of PyMzn are to provide inline problem specification,
solution parsing, isolation of the solving instances and dynamic modelling.
These problems arise when one has a sequence of instances of a problem to
solve, possibly in parallel. To be able to ensure automatically isolation of
the original problem from the solving instance, the <code class="docutils literal"><span class="pre">pymzn.minizinc</span></code> function
always compiles a new model file with a <em>_n</em> appended to the name. Here <em>n</em> is
0 if the serialization is not activated, otherwise <em>n</em> is an increasing
natural number starting from 1. The counter is an instance of
<code class="docutils literal"><span class="pre">itertools.count()</span></code>, which is provably thread-safe, thereby ensuring
isolation of solving instances running in parallel.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="reference/bin/pymzn.bin.run.html" class="btn btn-neutral" title="pymzn.bin.run" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Paolo Dragone.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.10.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>